{"version":3,"sources":["../../src/helpers/CachedApi.js"],"names":["CachedApi","api","_cachedUrls","_api","args","_request","url","params","data","hash","_strToHashCode","JSON","stringify","callType","getCached","_getCachedUrl","Promise","resolve","then","_addCachedUrl","response","catch","error","str","length","i","char","charCodeAt"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;AAqBA,WAAaA,SAAb;AAEI,uBAAYC,GAAZ,EAAiB;AAAA;;AACb,aAAKC,WAAL,GAAmB,EAAnB;AACA,aAAKC,IAAL,GAAYF,GAAZ;AACH;;AALL;AAAA;AAAA,+BAOkB;AAAA,8CAANG,IAAM;AAANA,oBAAM;AAAA;;AAEV,mBAAO,KAAKC,QAAL,CAAcD,IAAd,EAAoB,MAApB,CAAP;AACH;AAVL;AAAA;AAAA,8BAYiB;AAAA,+CAANA,IAAM;AAANA,oBAAM;AAAA;;AAET,mBAAO,KAAKC,QAAL,CAAcD,IAAd,EAAoB,KAApB,CAAP;AACH;AAfL;AAAA;AAAA,sCAiBkBE,GAjBlB,EAiBuBC,MAjBvB,EAiB+BC,IAjB/B,EAiBqC;;AAE7B,gBAAMC,OAAO,KAAKC,cAAL,MAAuBJ,GAAvB,GAA6BK,KAAKC,SAAL,CAAeL,MAAf,CAA7B,CAAb;AACA,iBAAKL,WAAL,CAAiBO,IAAjB,IAAyBD,IAAzB;AACH;AArBL;AAAA;AAAA,sCAuBkBF,GAvBlB,EAuBuBC,MAvBvB,EAuB+B;AACvB,gBAAME,OAAO,KAAKC,cAAL,MAAuBJ,GAAvB,GAA6BK,KAAKC,SAAL,CAAeL,MAAf,CAA7B,CAAb;AACA,mBAAO,KAAKL,WAAL,CAAiBO,IAAjB,CAAP;AACH;AA1BL;AAAA;AAAA,iCA4BaL,IA5Bb,EA4BmBS,QA5BnB,EA4B6B;AAAA;AAAA;;AAErB,gBAAMP,MAAMF,KAAK,CAAL,CAAZ;AACA,gBAAMG,SAASH,KAAK,CAAL,CAAf;;AAEA,gBAAMU,YAAY,KAAKC,aAAL,CAAmBT,GAAnB,EAAwBC,MAAxB,CAAlB;;AAEA,gBAAIO,SAAJ,EAAe;AACX,uBAAOE,QAAQC,OAAR,CAAgBH,SAAhB,CAAP;AACH;AACD,mBAAO,aAAKX,IAAL,EAAUU,QAAV,iCAAuBT,IAAvB,GACFc,IADE,CACG,oBAAY;AACd,sBAAKC,aAAL,CAAmBb,GAAnB,EAAwBC,MAAxB,EAAgCa,QAAhC;AACA,uBAAOA,QAAP;AACH,aAJE,EAKFC,KALE,CAKI,iBAAS;AACZ,uBAAOC,KAAP;AACH,aAPE,CAAP;AAQH;AA9CL;AAAA;AAAA,uCAgDmBC,GAhDnB,EAgDwB;AAChB,gBAAId,OAAO,CAAX;AACA,gBAAIc,IAAIC,MAAJ,KAAe,CAAnB,EAAsB,OAAOf,IAAP;AACtB,iBAAK,IAAIgB,IAAI,CAAb,EAAgBA,IAAIF,IAAIC,MAAxB,EAAgCC,GAAhC,EAAqC;AACjC,oBAAMC,OAAOH,IAAII,UAAJ,CAAeF,CAAf,CAAb;AACAhB,uBAAQ,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBiB,IAA9B;AACAjB,uBAAOA,OAAOA,IAAd,CAHiC,CAGb;AACvB;AACD,mBAAOA,IAAP;AACH;AAzDL;;AAAA;AAAA","file":"CachedApi.js","sourcesContent":["/**\r\n * Cachear API\r\n *\r\n * Como usar:\r\n * const cachedApi = new CachedApi(Abstração de uma biblioteca API);\r\n * Ex.:\r\n * const cachedApi = new CachedApi(axiosApi);\r\n *\r\n *\r\n * cachedApi.post(url, params)\r\n * cachedApi.get(url, params)\r\n * Ex.:\r\n * cachedApi.post(`/contrato/contrato/agrupamento`, {codigoAgrupadores})\r\n *\r\n * todo:\r\n * - Colocar configuração de tempo de cache\r\n * - Guardar em storage\r\n * - Otimizar\r\n *\r\n * */\r\n\r\nexport class CachedApi {\r\n\r\n    constructor(api) {\r\n        this._cachedUrls = [];\r\n        this._api = api;\r\n    }\r\n\r\n    post(...args) {\r\n\r\n        return this._request(args, 'post');\r\n    }\r\n\r\n    get(...args) {\r\n\r\n        return this._request(args, 'get');\r\n    }\r\n\r\n    _addCachedUrl(url, params, data) {\r\n\r\n        const hash = this._strToHashCode(`${url}${JSON.stringify(params)}`);\r\n        this._cachedUrls[hash] = data;\r\n    }\r\n\r\n    _getCachedUrl(url, params) {\r\n        const hash = this._strToHashCode(`${url}${JSON.stringify(params)}`);\r\n        return this._cachedUrls[hash];\r\n    }\r\n\r\n    _request(args, callType) {\r\n\r\n        const url = args[0];\r\n        const params = args[1];\r\n\r\n        const getCached = this._getCachedUrl(url, params);\r\n\r\n        if (getCached) {\r\n            return Promise.resolve(getCached);\r\n        }\r\n        return this._api[callType](...args)\r\n            .then(response => {\r\n                this._addCachedUrl(url, params, response);\r\n                return response;\r\n            })\r\n            .catch(error => {\r\n                return error;\r\n            });\r\n    }\r\n\r\n    _strToHashCode(str) {\r\n        let hash = 0;\r\n        if (str.length === 0) return hash;\r\n        for (let i = 0; i < str.length; i++) {\r\n            const char = str.charCodeAt(i);\r\n            hash = ((hash << 5) - hash) + char;\r\n            hash = hash & hash; // Convert to 32bit integer\r\n        }\r\n        return hash;\r\n    }\r\n\r\n}"]}